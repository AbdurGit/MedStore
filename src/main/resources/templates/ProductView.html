<!DOCTYPE html>
<html>

<head>
    <meta charset="ISO-8859-1">
    <title>Product List</title>
    <script src="lib/jquery-3.6.0.js"></script>
    <link rel="stylesheet" href="lib/bootstrap-4.0.0-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/header.css">
    <script src="lib/bootstrap-4.0.0-dist/js/bootstrap.min.js"></script>
    <script src="js/header.js"></script>


    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.4/css/dataTables.bootstrap4.min.css">

    <script src="https://cdn.datatables.net/1.11.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.4/js/dataTables.bootstrap4.min.js"></script>

    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.0/jquery.validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/additional-methods.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>





    <style>
        .main-content {
            background-color: white;
            border: 1px solid #ddd;
            margin-top: 40px;
            padding-top: 30px;
            padding-bottom: 30px;
            border-radius: 5px;
        }

        .error {
            color: red;

        }


        .pdt-name {
            font-weight: 700;
            color: #636363;
        }

        .title {
            font-weight: 600;
            margin-top: 20px;
            color: rgb(226 39 95 / 75%);

        }

        .value {
            margin-top: 5px;
            color: rgb(151, 151, 151);

        }

        .img-wrap {

            padding: 5px;
            border: 1px solid #eee;
            transition: box-shadow 0.5s;
        }

        .img-wrap:hover {
            box-shadow: 1px 1px 10px rgb(197, 197, 197);
        }
    </style>
    <script>
        $(document).ready(function () {



            $('#pdtTable').DataTable({
                ajax: {
                    url: 'http://192.168.1.102:8080/getAllProducts',
                    dataSrc: ''
                },

                columns: [

                    {
                        data: 'productName'
                    },

                    {
                        data: 'batch'
                    },
                    {
                        data: 'expDate',
                        render: function (data, type, row) {
                            if (type === "sort" || type === "type") {
                                return data;
                            }
                            return moment(data).format("DD-MM-YYYY");
                        }
                    },
                    {
                        data: 'mfgDate',
                        render: function (data, type, row) {
                            if (type === "sort" || type === "type") {
                                return data;
                            }
                            return moment(data).format("DD-MM-YYYY");
                        }
                    },
                    {
                        data: 'mrp'
                    },
                    {
                        data: 'noBoxBought'
                    },
                    {
                        data: 'noBoxSold'
                    },
                    {
                        data: 'sellerName'
                    },
                    {
                        data: null,
                        render: function (data, type, row) {
                            // Combine the first and last names into a single table field
                            return "<button type=\"button\" style=\" margin-right: 10px;\"" +
                                "class=\"btn btn-outline-success btn-sm viewpdt\" data-id=\"" +
                                data.id +
                                "\">View</button>" +
                                "<button type=\"button\" style=\" margin-right: 10px;\"" +
                                "class=\"btn btn-outline-primary btn-sm editpdt\" data-id=\"" +
                                data.id +
                                "\">Edit</button>" +
                                "<button  class=\"btn btn-outline-danger btn-sm deletepdt\" data-id=\"" +
                                data.id +
                                "\">Delete</button>";
                        }
                    }
                ]


            });

            $('#pdtTable').on('click', '.deletepdt', function () {


                alert("delete clicked");
                var pdtId = $(this).attr("data-id");
                $.ajax({
                    type: "GET",
                    url: "http://192.168.1.102:8080/deleteProduct",
                    data: {
                        productId: pdtId
                    },
                    success: function (data) {

                        $('#pdtTable').DataTable().ajax.reload();

                    },
                    error: function (xhr, status, error) {

                        alert("Exception occured!");
                        console.log(xhr.responseText);
                    }

                });


            })

            $('#pdtTable').on('click', '.editpdt', function () {

                var pdtId = $(this).attr("data-id");
                $('#pdtTable_wrapper').hide("fast");
                $('#productUpdateForm').show("fast");
                $('#pdtIdHidden').attr("data-id", pdtId);
                $('#pdtIdHidden').val(pdtId);

                populateForm(pdtId);


            })

            function populateForm(productId) {
                $.ajax({
                    type: "GET",
                    url: "http://192.168.1.102:8080/getProductById/" + productId,

                    success: function (data) {


                        console.log(data);

                        $("#pdtNameInput").val(data.productName);
                        $("#pdtDescInput").val(data.productDesc);
                        $("#pdtMfgInput").val(changeDateFormat(data.mfgDate));
                        $("#pdtExpInput").val(changeDateFormat(data.expDate));
                        $("#pdtBatchInput").val(data.batch);
                        $("#pdtMrpInput").val(data.mrp);
                        $("#pdtSellerInput").val(data.sellerName);
                        $("#pdtDiscountInput").val(data.percentageDiscount);
                        $("#pdtMedTypeInput").val(data.medType);

                        $("#boxNoBoughtInput").val(data.noBoxBought);
                        $("#boxNoSoldInput").val(data.noBoxSold);
                        $("#addNoteInput").val(data.additionalNotes);



                    },
                    error: function (xhr, status, error) {

                        alert("Exception occured!");
                        console.log(xhr.responseText);
                    }

                });

            }

            $("#productUpdateForm").validate({
                rules: {
                    pdtNameInput: {
                        required: true,
                    },
                    pdtMfgInput: {
                        required: true,
                    },
                    pdtBatchInput: {
                        required: true,
                    },
                    pdtExpInput: {
                        required: true,
                    },
                    pdtMrpInput: {
                        required: true,
                        number: true
                    },
                    pdtDiscountInput: {

                        number: true

                    },
                    pdtSellerInput: {
                        required: true,
                    },
                    boxNoBoughtInput: {

                        digits: true
                    },
                    boxNoSoldInput: {

                        digits: true
                    },



                },
                messages: {
                    pdtNameInput: {
                        required: "Please enter product Name",
                    },
                    pdtMfgInput: {
                        required: "Please enter mfg date",
                    },
                    pdtBatchInput: {
                        required: "Please enter batch number",
                    },
                    pdtExpInput: {
                        required: "Please enter exp date",
                    },
                    pdtMrpInput: {
                        required: "Please enter Price",
                        number: "Provide a valid number"
                    },
                    pdtSellerInput: {
                        required: "Please enter seller name",
                    },


                    pdtDiscountInput: {

                        number: "Provide a valid number"

                    },

                    boxNoBoughtInput: {

                        digits: "Provide a valid integer number"
                    },
                    boxNoSoldInput: {

                        digits: "Provide a valid integer number"
                    },
                },



                submitHandler: function (form) {
                    var pdtId = $("#pdtIdHidden").val();
                    var pdtName = $("#pdtNameInput").val();
                    var pdtDesc = $("#pdtDescInput").val();
                    var mfgDate = changeDateFormat($("#pdtMfgInput").val());
                    var expDate = changeDateFormat($("#pdtExpInput").val());
                    var batch = $("#pdtBatchInput").val();
                    var mrp = $("#pdtMrpInput").val();
                    var seller = $("#pdtSellerInput").val();
                    var discount = $("#pdtDiscountInput").val();
                    var medtype = $("#pdtMedTypeInput").val();

                    var boxBought = $("#boxNoBoughtInput").val();
                    var boxSold = $("#boxNoSoldInput").val();
                    var note = $("#addNoteInput").val();

                    $.ajax({
                        type: "GET",
                        url: "http://192.168.1.102:8080/updateProduct",
                        data: {
                            productId: pdtId,
                            productName: pdtName,
                            productDescription: pdtDesc,
                            mfgDate: mfgDate,
                            expDate: expDate,
                            batch: batch,
                            mrp: mrp,
                            seller: seller,
                            discount: discount,
                            medtype: medtype,
                            boxBought: boxBought,
                            boxSold: boxSold,

                            note: note,

                        },
                        success: function (data) {
                            console.log(data);
                            $('#pdtIdHidden').attr("data-id", "");
                            $('#pdtIdHidden').val("");
                            $('#productUpdateForm').hide("fast");
                            $('#pdtTable_wrapper').show("fast");

                            $('#pdtTable').DataTable().ajax.reload();




                        },
                        error: function (xhr, status, error) {

                            alert("Exception occured!");
                            console.log(xhr.responseText);
                        }

                    });
                }
            });

            function changeDateFormat(date) {
                var changedFormat = '';

                if (date != null || date != undefined || date != "") {
                    var dtArray = date.split("-");
                    changedFormat = dtArray[2] + '-' + dtArray[1] + '-' + dtArray[0];
                }


                return changedFormat;

            }



        });
    </script>

</head>



<body style="background: #eee;">

    <nav class="navbar navbar-expand-lg navbar-light bg-light"
        style="box-shadow: 1px 1px 11px #ddd;position: relative;">
        <a class="navbar-brand" href="#" style="color: #dc3563;">Med Store</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo02"
            aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse navbar-center" id="navbarTogglerDemo02">
            <ul class="navbar-nav  mr-auto mt-2 mt-lg-0 navul">
                <li class="nav-item ">
                    <a class="nav-link " href="http://192.168.1.102:8080/medstore" id="loadHomePage">Home <span
                            class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item liclicked">
                    <a class="nav-link navclicked" href="http://192.168.1.102:8080/pdtListPage"
                        id="loadAllProductsPage">Products</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Category</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://192.168.1.102:8080/pdtUploadPage"
                        id="loadProductUploadPage">Upload</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://192.168.1.102:8080/advancedSearchPage"
                        id="loadAdvSearchPage">Advanced
                        Search</a>
                </li>

            </ul>
            <!-- <form class="form-inline my-2 my-lg-0">
      <input class="form-control mr-sm-2" type="search" placeholder="Search">
      <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
    </form> -->
        </div>
    </nav>

    <div class="container">
        <div class="row">
            <div class="col">
            </div>
            <div class="col-10  main-content">
                <div class="container" id="pdtViewContainer">
                    <h4 class="form-title">Product View</h4>
                    <div>
                        <h4 class="pdt-name" id="pdtname"> Paracetamol 650 mg</h4>

                    </div>
                    <div class="row">
                        <div class="col-6">

                            <div class="propGroup col-sm-12 ">
                                <div class="title" id=""> Description</div>
                                <div class="value" id=""> Our latest exploration about landing page NFT Website Landing
                                    Page
                                    Template Design are a fully-featured UI Design kit for NFT Marketplace,
                                    together with exclusive design files and excellent 3D illustrations editable in
                                    Figma.</div>
                            </div>
                            <div class="col-sm-12" style="margin-top:20px;">
                                <img class="img-fluid img-wrap" src="pcm.jpg">

                            </div>

                        </div>

                        <div class="col-6">
                            <div class="row">
                                <div class="propGroup col-sm-6">
                                    <div class="title" id=""> Batch Id</div>
                                    <div class="value" id=""> B-004-100</div>
                                </div>
                                <div class="propGroup col-sm-6">
                                    <div class="title" id=""> Manufacturing Date</div>
                                    <div class="value" id=""> 22-02-2022</div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="propGroup col-sm-6">
                                    <div class="title" id=""> Expiry Date:</div>
                                    <div class="value" id=""> 15-03-2024</div>
                                </div>


                                <div class="propGroup col-sm-6">
                                    <div class="title" id=""> Price</div>
                                    <div class="value" id=""> 350.47</div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="propGroup col-sm-6">
                                    <div class="title" id=""> Price</div>
                                    <div class="value" id=""> 350.47</div>
                                </div>

                                <div class="propGroup col-sm-6">
                                    <div class="title" id=""> Seller</div>
                                    <div class="value" id=""> Modern Medicine House</div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="propGroup col-sm-6">
                                    <div class="title" id=""> Discount</div>
                                    <div class="value" id="">10%</div>
                                </div>
                                <div class="propGroup col-sm-6">
                                    <div class="title" id="">Medicine Type </div>
                                    <div class="value" id="">Pill/Tablet</div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="propGroup col-sm-6">
                                    <div class="title" id=""> Box Bought</div>
                                    <div class="value" id="">20</div>
                                </div>
                                <div class="propGroup col-sm-6">
                                    <div class="title" id=""> Box Sold
                                    </div>
                                    <div class="value" id="">10 </div>
                                </div>
                            </div>
                            <div class="propGroup">
                                <div class="title" id="">Additional Note
                                </div>
                                <div class="value" id="">Our latest exploration about landing page NFT Website Landing
                                    Page
                                    Template Design are a fully-featured UI Design kit for NFT Marketplace,
                                    together with exclusive design files and excellent 3D illustrations editable in
                                    Figma.</div>
                            </div>
                        </div>
                    </div>

                </div>


            </div>
            <div class="col">
            </div>
        </div>
    </div>









</body>

</html>